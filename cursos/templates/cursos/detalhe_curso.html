{% extends 'cursos/base.html' %}
{% load static %}

{% block conteudo %}
<div class="main-container">
    <h1 style="color: {{ curso.cor_neon }}; text-shadow: 0 0 10px {{ curso.cor_neon }}55;">{{ curso.nome }}</h1>
    <p style="color: #888; margin-bottom: 30px;">Conteúdo e materiais de apoio</p>

    <div style="display: grid; gap: 30px;">
        {% for modulo in curso.modulos.all %}
            <div class="modulo-section">
                <h2 style="color: #fff; border-left: 4px solid {{ curso.cor_neon }}; padding-left: 15px; margin-bottom: 20px;">
                    {{ modulo.titulo }}
                </h2>

                <div style="display: grid; gap: 20px;">
                    {% for material in modulo.materiais.all %}
                        <div class="glass-card" style="padding: 20px; border: 1px solid rgba(255,255,255,0.1);">
                            
                            {# --- CABEÇALHO DO CARD COM BOTÕES DE AÇÃO --- #}
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px;">
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    {% if material.tipo_arquivo == 'link' %}
                                        <i class="fab fa-youtube" style="font-size: 1.8rem; color: #ff0000;"></i>
                                    {% elif material.tipo_arquivo == 'video' %}
                                        <i class="fas fa-play-circle" style="font-size: 1.8rem; color: {{ curso.cor_neon }};"></i>
                                    {% elif material.tipo_arquivo == 'pdf' or ".pdf" in material.arquivo.name|lower %}
                                        <i class="fas fa-file-pdf" style="font-size: 1.8rem; color: #ff4757;"></i>
                                    {% else %}
                                        <i class="fas fa-image" style="font-size: 1.8rem; color: #00d2d3;"></i>
                                    {% endif %}
                                    <h3 style="margin: 0; font-size: 1.1rem; color: #eee;">{{ material.titulo }}</h3>
                                </div>

                                <div style="display: flex; gap: 10px;">
                                    {# BOTÃO DE DOWNLOAD (Apenas para arquivos reais) #}
                                    {% if material.arquivo %}
                                        <a href="{{ material.arquivo.url }}" download="{{ material.titulo }}" class="btn-entrar" 
                                           style="text-decoration: none; font-size: 0.75rem; padding: 7px 12px; background: rgba(255,255,255,0.1); border: 1px solid {{ curso.cor_neon }}; color: #fff;">
                                            <i class="fas fa-download"></i> BAIXAR ARQUIVO
                                        </a>
                                    {% endif %}
                                    
                                    {# BOTÃO ABRIR EM NOVA GUIA (Especialmente para PDF) #}
                                    {% if material.tipo_arquivo == 'pdf' or ".pdf" in material.arquivo.name|lower %}
                                        <a href="{{ material.arquivo.url }}" target="_blank" class="btn-entrar" 
                                           style="text-decoration: none; font-size: 0.75rem; padding: 7px 12px; background: {{ curso.cor_neon }}; border: none; color: #000; font-weight: bold;">
                                            <i class="fas fa-external-link-alt"></i> VER EM TELA CHEIA
                                        </a>
                                    {% endif %}
                                </div>
                            </div>

                            {# --- ÁREA DE VISUALIZAÇÃO INTERNA --- #}
                            <div class="visualizacao-container" style="background: rgba(0,0,0,0.3); border-radius: 8px; overflow: hidden;">
                                
                                {# 1. LINK EXTERNO (YOUTUBE / DRIVE) #}
                                {% if material.tipo_arquivo == 'link' %}
                                    <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
                                        <iframe src="{{ material.embed_url }}" 
                                                style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0;" 
                                                allowfullscreen></iframe>
                                    </div>

                                {# 2. VÍDEO DO CLOUDINARY #}
                                {% elif material.tipo_arquivo == 'video' %}
                                    <video controls controlsList="nodownload" style="width: 100%; display: block;">
                                        <source src="{{ material.arquivo.url }}" type="video/mp4">
                                        Seu navegador não suporta vídeos.
                                    </video>

                                {# 3. IMAGEM DO CLOUDINARY (Com trava para PDF) #}
                                {% elif material.tipo_arquivo == 'imagem' and ".pdf" not in material.arquivo.name|lower %}
                                    <div style="text-align: center; padding: 10px;">
                                        <img src="{{ material.arquivo.url }}" style="max-width: 100%; max-height: 500px; border-radius: 4px;">
                                    </div>

                                {# 4. PDF (Ou arquivo identificado errado pelo Cloudinary) #}
                                {% else %}
                                    <div style="text-align: center; padding: 40px; background: rgba(255,255,255,0.02);">
                                        <i class="fas fa-file-pdf" style="font-size: 3rem; color: #ff4757; margin-bottom: 15px;"></i>
                                        <p style="color: #ddd;">Documento pronto para leitura.</p>
                                        <p style="color: #666; font-size: 0.8rem; margin-bottom: 15px;">(Abertura em nova guia para melhor experiência)</p>
                                        <a href="{{ material.arquivo.url }}" target="_blank" style="color: #fff; text-decoration: none; background: #ff4757; padding: 10px 20px; border-radius: 5px; font-weight: bold; display: inline-block;">
                                            VISUALIZAR AGORA
                                        </a>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% empty %}
                        <p style="color: #555; font-style: italic; margin-left: 20px;">Nenhum material neste módulo.</p>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}